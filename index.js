var e={},t=class e{constructor(e){return Object.assign(this,{props:{},data:{},children:{},listeners:{},preRender:{},postRender:{},...e,...this}),new Proxy(this,{get:(e,t,i)=>t in e?e[t]:t in e.children?e.children[t]:Reflect.get(e,t,i)})}lookup(e,t=[]){let i="string"==typeof e?new RegExp(`^${e.replace("*",".*")}$`):e;for(let[n,s]of Object.entries(this.children))i.test(n)||s.name&&i.test(s.name)?t.push(s):t=this.children[n].lookup(e,t);return t}assignProps(){Object.assign(this.node,this.props),this.props.style&&Object.assign(this.node.style,this.props.style),Object.entries(this.data).forEach((([e,t])=>this.node.dataset[e]=t))}attachListeners(){for(let[e,t]of Object.entries(this.listeners)){let i={};t instanceof Array&&([t,i]=t),this.node.addEventListener(e,t.bind(this),i)}}bindProps(){Object.entries(this.bindings??{}).forEach((([e,{get:t,set:i}])=>{Object.defineProperty(this,e,{get:t,set:i})}))}prepareChildren(){for(let[t,i]of Object.entries(this.children))i.name=i.name?i.name:isNaN(t)?t:i.constructor.name,i instanceof e||(this.children[t]=new e({parent:this,...i}))}async toString(){return await this.prepareNode(),this.node.outerHTML}async toNode(){return await this.prepareNode(),this.node}async createElement(){let e=this.name.toLowerCase();if(this.elementClass&&(e+=-1==e.indexOf("-")?"-element":"",!customElements.get(e))){if("string"==typeof this.elementClass){let e=(await import(`${this.elementClass}.js`)).default;this.elementClass=(t=e,class extends t{})}customElements.define(e,this.elementClass,this.elementProps??{})}var t;return document.createElement(e)}async render(e=!1){if(e&&this.node)for(;this.node.firstChild;)this.node.removeChild(this.node.firstChild);else this.node=await this.createElement(),this.assignProps(),this.bindProps(),this.attachListeners(),this.node.component=this;this.prepareChildren(),this.node.dispatchEvent(new CustomEvent(e?"rerendered":"rendered"))}async prepareNode(e=!1){if(!this.node||e){for(let e of Object.values(this.preRender))e(this);await this.render(e);for(let[e,t]of Object.entries(this.children))t.appendTo(this.node,e);for(let e of Object.values(this.postRender))e(this)}}async appendTo(t,i=""){return this.name=this.name?this.name:isNaN(i)?i:this.constructor.name,t instanceof Node&&(await this.prepareNode(),t.appendChild(this.node)),t instanceof e&&(t.children={...t.children,[i]:this},t.node&&(await this.prepareNode(),t.node.appendChild(this.node))),this}},i={files:"RBDEFGHIKLS",firstHomeFile:"E",lastHomeFile:"I",centerFile:"A",promotions:{pawn:{name:"pawn",steps:1},infantry:{title:"⇧",name:"infantry",steps:2,canJump:!1},rider:{title:"⇯",name:"rider",position:"R4",steps:3,canJump:!0,ignoreImmunity:!0},sentinel:{title:"+",name:"sentinel",position:"S11",steps:3,reviveSteps:2,centerImmunity:!0,ignoreImmunity:!0}},resultsConditions:{positionVictoryPoints:2,specialPositionVictoryPoints:3,dominationVictory:8,dominationVictoryPoints:1,dominationVictoryPointsDisplay:"1",drawPoints:.5,drawPointsDisplay:"½"}},n=class extends t{name="cell";constructor(t=!1){super(),!1!==t&&(this.position=t,e.cellsData[t].cell=this)}listeners={click:t=>{let i=this.position;e.activePiece&&e.activePiece.movePiece(i)}}},s=class extends n{name="segment";constructor(t,n=0){super(),this.rotation=t,this.skew=72,this.offset=18,this.props.className="field"+((n+t)%2?" dark":""),this.position=(9==t?i.files[0]:19==t?i.files.slice(-1):i.files.slice(1,-1)[8-(t<9?t:18-t)])+(t<10?7-n:8+n),e.cellsData[this.position].cell=this}postRender={attr:e=>{["offset","rotation","skew","position"].map((t=>e.node.setAttribute(t,e[t]))),e.node.style.transform=`rotate(${(this.offset*this.rotation+this.offset/2).toFixed(2)}deg) skew(${this.skew.toFixed(2)}deg)`}}},o=class extends n{name="halo";props={className:"small"};position=i.centerFile;postRender={attr:t=>{this.node.setAttribute("position",this.position),e.cellsData[this.position].cell=this}}},r=class e extends t{name="halo";constructor(t){super(),this.props.className=2==t?"outer":t?"":"inner",this.children={outer:{children:{div:{children:{inner:{children:Object.fromEntries([...Object.entries(Array(20).fill().map(((e,i)=>new s(i,t)))),["halo",t?new e(t-1):new o]])}}}}}}}},l=class extends t{name="row";constructor(e){super(),this.children={0:new n("E"+e),1:new n("F"+e),2:new n("G"+e),3:new n("H"+e),4:new n("I"+e)}}},a=class extends t{constructor(e){super(),this.player=e,this.children={0:new l(11*(1-e)+3),1:new l(11*(1-e)+2),2:new l(11*(1-e)+1)}}},c=(e,t={})=>e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=h(e,t)).replace(/!\[video\]\((.+?)\)/g,'<video controls src="$1"></video>')).replace(/!\[(.*?)\]\((.+?)\)/g,'<img src="$2" alt="$1">')).replace(/^### (.+)$/gm,"<h3>$1</h3>")).replace(/^## (.+)$/gm,"<h2>$1</h2>")).replace(/^# (.+)$/gm,"<h1>$1</h1>")).replace(/\*\*(.+?)\*\*/g,"<b>$1</b>")).replace(/\*(.+?)\*/g,"<i>$1</i>")).replace(/^\s*-\s+(.+)$/gm,"<li>$1</li>")).replace(/(<li>.*<\/li>)/gms,"<ul>$1</ul>")).replace(/\n/g,""),h=(e,t={})=>{for(let[i,n]of Object.entries(t)){let t=new RegExp(`:${i}`,"g");e=e.replace(t,n)}return e},p=(e,t)=>t[e],d=(e,t)=>t.indexOf(e),m=e=>e[0].toUpperCase()+e.slice(1),u=class extends HTMLElement{observableAttributes={position:this.renderPosition.bind(this)};constructor(){super()}connectedCallback(){new MutationObserver(((e,t)=>{for(let t of e){let e=t.attributeName;"attributes"===t.type&&this.observableAttributes[e]&&this.observableAttributes[e]()}})).observe(this,{attributes:!0})}renderPosition(){let e=0,t=0;if(this.component.taken){let i=this.getAttribute("position").slice(1);e=i>6?559:5,t=this.component.owner?(i-1)%6*40+5:975-(i-1)%6*40}else{let[s,o]=[(n=this.getAttribute("position")).slice(0,1),n.slice(1)],r=s>=i.firstHomeFile&&s<=i.lastHomeFile&&(o<=3||o>=12);if(e=100*(d(s,i.files)-d(i.firstHomeFile,i.files))+82,t=o>4?70*(14-o)+15:1020-70*o+20,!r){let n=d(s,i.files)-d(i.firstHomeFile,i.files)-2,r=o-8+(o>7),l=[269,204,143,99][4-Math.abs(r)],a=Math.abs(n)*Math.PI/10,c=s==i.files[0]&&4==o?25:s==i.files.slice(-1)&&11==o?11:18;e=300+(l*Math.sin(a)*(n>=0?1:-1)-c||-17),t=510-(l*Math.cos(a)*(r>=0?1:-1)+18||17)}}var n;this.style.left=e+"px",this.style.top=t+"px"}},f=class extends t{name="button-popup";constructor(e,t,i){super(),this.piece=e,this.func=t,this.title=i,this.children={button:{props:{innerText:this.title},listeners:{click:e=>{this.func()}}}}}remove=e=>{this.node.remove()};postRender={move:e=>{this.node.style=`top: ${parseInt(this.piece.node.style.top)-18}px; left: ${parseInt(this.piece.node.style.left)+18}px`}}},g=class extends t{name="piece";elementClass=u;constructor(e,t,n=null,s="pawn",o=null){super(),this.color=null!==o?o:~~(e>14),this._role=s,this.taken=!1,this.owner=this.color,this.props.className=this.color?"white":"black",this._position=n||i.files.slice(3,-3)[e%5]+(e>14?3-~~((e-15)/5):14-~~(e/5)),this.updatePosition(this._position)}bindings={active:{set:e=>{this._active=e,e?this.node.classList.add("active"):this.node.classList.remove("active")},get:e=>this._active??!1},position:{set:e=>{this._position=e,this.node.setAttribute("position",e)},get:e=>this._position??null},role:{set:e=>{this._role=e,this.node.classList.remove(...Object.keys(i.promotions)),this.node.innerText="",e&&(this.node.classList.add(e),i.promotions[e].title&&(this.node.innerText=i.promotions[e].title))},get:e=>this._role}};postRender={attr:e=>{setTimeout((t=>{e.role=e._role,e.node.setAttribute("position",e.position)}),1)}};updatePosition=(t=!1)=>e.cellsData[t??this.position].piece=this;canMove=e=>this.allowedCells(this.position).length>0;allowedCells=(t,n,s=!1)=>{let o=[],r=n>=(s?i.promotions[this.role].reviveSteps:i.promotions[this.role].steps),l=i.promotions[this.role].canJump;if(!n||!r){let i=e.game.getNeighbourCells(t);i=i.filter((e=>l&&!r?this.existingCell(e):r?this.allowedCell(e):this.existingCell(e))),o=i;for(let e of l&&!r?i:i.filter((e=>!this.occupiedCell(e))))o=[...new Set([...o,...this.allowedCells(e,(n??0)+1,s)])]}return o.filter(this.allowedCell)};existingCell=t=>typeof e.cellsData[t]<"u";occupiedCell=t=>null!=e.cellsData[t].piece;hasOwnPiece=t=>e.cellsData[t].piece.owner==this.owner;isRevived=t=>e.cellsData[t].piece.revived;hasImmunity=t=>i.promotions[e.cellsData[t].piece.role].centerImmunity;allowedCell=t=>this.existingCell(t)&&(!this.occupiedCell(t)||!this.hasOwnPiece(t)&&!this.isRevived(t)&&(t!==i.centerFile||!this.hasImmunity(t)||i.promotions[this.role].ignoreImmunity||e.revived));isLegalMove=t=>{let i=this.allowedCells(this.position);return!e.cellsData[t].piece&&-1!==i.indexOf(t)};isLegalTake=t=>-1!==this.allowedCells(this.position).indexOf(t)&&e.cellsData[t].piece&&e.cellsData[t].piece.owner!=this.owner;showAllowed=t=>{let i=this.allowedCells(this.position);for(let t in i)e.cellsData[i[t]].cell.node.classList.add("allowed");if("sentinel"==this.role){let t=this.allowedCells(this.position,0,!0);for(let i in t)e.cellsData[t[i]].cell.node.classList.add("revive-allowed")}};checkPromotion=t=>{this.position==i.promotions.rider.position&&("sentinel"==this.role&&(e.sentinels[["black","white"][this.owner]]=!1),this.role="rider"),this.position==i.promotions.sentinel.position&&!e.sentinels[["black","white"][this.owner]]&&(this.role="sentinel",e.sentinels[["black","white"][this.owner]]=!0)};changePosition=(t,i=!1)=>{e.cellsData[this.position].piece=null,e.cellsData[t].piece=this;let n={};i&&(n.taken=!0);let s=this.role,o=this.position;this.position=t,this.checkPromotion(),s!=this.role&&(n.promotion={old:s,new:this.role}),e.gameInfo.logMove([o.toLowerCase(),t.toLowerCase()],"move",n),this.active=!1,e.game.changePlayer()};movePiece=t=>{if(e.game.buttonPopup&&e.game.buttonPopup.remove(),this.isLegalMove(t))this.changePosition(t);else if(null!=e.cellsData[t].piece)if(e.cellsData[t].piece.owner==e.activePlayer)this.active=!1,e.activePiece=e.cellsData[t].piece;else if(this.isLegalTake(t)&&!e.cellsData[t].piece.revived){let i=e.cellsData[t].piece;i.taken=!0,"sentinel"==i.role&&(e.sentinels[["black","white"][i.owner]]=!1),i.role="pawn",i.previousPosition=t,i.position="X"+(+e.taken[["black","white"][i.owner]].length+1),e.taken[["black","white"][i.owner]].push(i),this.changePosition(t,!0)}};checkPieceOwner=t=>typeof e.cellsData[t]<"u"&&null!==e.cellsData[t].piece&&e.cellsData[t].piece.owner==this.owner;showPopupButton=(t,i)=>{e.game.buttonPopup&&e.game.buttonPopup.remove(),e.game.buttonPopup=new f(this,t,i),e.game.buttonPopup.appendTo(this.node.parentNode)};checkInfantryPromotion=t=>{if("pawn"!=this.role)return!1;let[n,s]=[(o=this.position).slice(0,1),o.slice(1)];var o,r;if("A"!=n&&(s<4&&this.owner||s>11))return!1;if("A"==n){let t=e.game.getNeighbourCells(this.position);for(let e of t){let[t,n]=[(r=e).slice(0,1),r.slice(1)],s=p(i.files.length-d(t,i.files)-1,i.files)+(15-n);if(this.checkPieceOwner(e)&&this.checkPieceOwner(s))return!0}return!1}{let[t,i,n,s]=e.game.getNeighbourCells(this.position);return this.checkPieceOwner(t)&&this.checkPieceOwner(i)||this.checkPieceOwner(n)&&this.checkPieceOwner(s)}};checkLastMoveTaken=t=>{let i=e.gameInfo.log[e.gameInfo.log.length-1],n=this.allowedCells(this.position,0,!0);return i.data&&i.data.taken&&"revive"!==i.type&&-1!==n.indexOf(i.move[1].toUpperCase())};promoteInfantry=t=>{e.game.buttonPopup.remove();let i=this.role;this.role="infantry",this.active=!1;let n={promotion:{old:i,new:this.role}};e.gameInfo.logMove([this.position.toLowerCase()],"promote",n),e.game.changePlayer()};revive=t=>{e.game.buttonPopup.remove();let i=e.gameInfo.log[e.gameInfo.log.length-1],n=e.cellsData[i.move[1].toUpperCase()].piece,s=e.taken[["black","white"][~~!n.owner]].pop();n.position=i.move[0].toUpperCase(),s.position=i.move[1].toUpperCase(),e.cellsData[i.move[0].toUpperCase()].piece=n,e.cellsData[i.move[1].toUpperCase()].piece=s,i.data.promotion&&i.data.promotion.old&&(n.role=i.data.promotion.old),s.taken=!1,s.revived=!0,e.revived=s,this.active=!1,e.gameInfo.logMove([this.position.toLowerCase()],"revive",{taker:i.move[0],taken:i.move[1]}),e.game.changePlayer()};makeActive=t=>{this.showAllowed(),this.checkInfantryPromotion()&&this.showPopupButton(this.promoteInfantry,"Promote"),"sentinel"==this.role&&this.checkLastMoveTaken()&&this.showPopupButton(this.revive,"Revive"),e.activePiece=this,this.active=!0};processClick=t=>{if(e.game.buttonPopup&&e.game.buttonPopup.remove(),e.activePiece){if(this.active&&e.activePlayer==this.owner)e.game.clearAllowed(),this.active=!1,e.activePiece=null;else if(e.activePlayer==this.owner&&this.canMove()){e.game.clearAllowed();for(let t in e.cellsData)e.cellsData[t].piece&&(e.cellsData[t].piece.active=!1);this.makeActive()}}else e.game.clearAllowed(),e.activePlayer==this.owner&&this.canMove()&&this.makeActive()};listeners={click:this.processClick}},v=class extends t{name="popup";constructor(e){super(),this.children.msg.props={innerHTML:e}}children={msg:{},closeButton:{listeners:{click:e=>{this.remove()}}}};remove=e=>{this.node.remove()}},w=class extends n{constructor(t,i,n){super(),this.name=i,this.position=n,this.props.innerText=t,e.cellsData[n].cell=this}},y=class extends t{name="game";children={blackside:{children:{black:new a(0)}},mainarea:{children:{rider:new w(i.promotions.rider.title,"rider",i.promotions.rider.position),gamearea:{children:{board:{children:Object.fromEntries([["center",{children:{inner:new r(2)}}],...Object.entries(Array(10).fill().map(((e,t)=>new s((t>4?t+5:t)+2,3))))])}}},sentinel:new w(i.promotions.sentinel.title,"sentinel",i.promotions.sentinel.position)}},whiteside:{children:{white:new a(1)}}};constructor(t){super();let i=null,n=1;t&&([n,i]=t);let s=null;s=i?Object.entries(i.map(((t,i)=>new g(i,e,t.cell,t.role,+("white"==t.color))))):Object.entries(Array(30).fill().map(((t,i)=>new g(i,e)))),Object.assign(this.children,Object.fromEntries(s)),e.activePlayer=n}clearAllowed=t=>{for(let t in e.cellsData)e.cellsData[t].cell.node.classList.remove("allowed","revive-allowed")};getNeighbourCells=e=>{let[t,n]=[(s=e).slice(0,1),s.slice(1)];var s;if(t==i.centerFile)return i.files.slice(0,-1).split("").map((e=>e+7)).concat(i.files.slice(1).split("").map((e=>e+8)));let o=d(t,i.files),[r,l]=[p(o?o-1:1,i.files),p(o<10?o+1:9,i.files)];r+=t==i.files[0]||t==i.files.slice(-1)||t==i.files[1]&&n>=8||t==i.files.slice(-1)&&n<=7?15-n:n,l+=t==i.files.slice(-2,-1)&&n<=7?15-n:n;let[a,c]=[7==n?i.centerFile:t+(+n+1),8==n?i.centerFile:t+(+n-1)];return[r,l,a,c]};checkWinningPosition=t=>{let n=e.cellsData[i.centerFile].piece;if(n&&"pawn"!=n.role){let t=!1,o={},r=n.owner,l=this.getNeighbourCells(i.centerFile);for(let a of l)if(e.cellsData[a].piece&&e.cellsData[a].piece.owner==r){let[l,c]=[(s=a).slice(0,1),s.slice(1)],h=p(i.files.length-1-d(l,i.files),i.files)+(15-c);if(e.cellsData[h].piece&&e.cellsData[h].piece.owner==r){t=!0,o={center:n.role,first:e.cellsData[a].piece.role,second:e.cellsData[h].piece.role};break}}if(t&&null!==r)return{winner:r,points:"sentinel"==o.center&&"rider"==o.first&&"rider"==o.second?i.resultsConditions.specialPositionVictoryPoints:i.resultsConditions.positionVictoryPoints}}var s;return null};checkDominationVictory=t=>e.taken.white.length>14&&e.taken.black.length<i.resultsConditions.dominationVictory||e.taken.black.length>14&&e.taken.white.length<i.resultsConditions.dominationVictory?{winner:e.taken.black.length>14}:null;checkDraw=t=>e.taken.white.length>12&&e.taken.black.length>i.resultsConditions.dominationVictory-1||e.taken.black.length>12&&e.taken.white.length>i.resultsConditions.dominationVictory-1;changePlayer=t=>{this.clearAllowed();let n=null;e.activePiece=null,e.revived&&e.revived.owner!=e.activePlayer&&(e.revived.revived=!1,e.revived=null),e.activePlayer=~~!e.activePlayer,n=this.checkDominationVictory();let s=!1;n&&typeof n.winner<"u"&&(this.showPopup(`Domination victory!<br />The winner is ${n.winner?"White":"Black"}!<br />The winner gets ${i.resultsConditions.dominationVictoryPointsDisplay} points.`),this.endGame(),s=!0),n=this.checkWinningPosition(),n&&typeof n.winner<"u"&&(this.showPopup(`Position victory!<br />The winner is ${n.winner?"White":"Black"}!<br />The winner gets ${n.points} points.`),this.endGame(),s=!0),this.checkDraw()&&(this.showPopup(`It's a draw!<br />Each player gets ${i.resultsConditions.drawPointsDisplay} points.`),this.endGame(),s=!0),e.activePlayer&&!s&&(e.gameInfo.turn=e.gameInfo.turn+1)};endGame=t=>{e.active=!1};showPopup=t=>{new v(t).appendTo(e.root)}},b=["### How to play","In this game, two players face off in a strategic contest to control the center of the board. The game board consists of two starting positions (home area), each having three rows, five cells in each, and a center area where the most action occurs. The center area has one central cell surrounded by three circles, each containing 20 cells. The center area connected to the home areas with two additional arcs, each containing 5 cells.","Each player begins the game with 15 pieces, called :pawn, arranged in three rows of five pieces each. One player controls the white pieces, while the other controls the black pieces. The whites move first. A :pawn can move one step to any adjacent cell that shares a common edge with its current position. The center cell is uniquely connected to all cells within the inner circle.","![Pawn](images/pawn.png) ![Center cell](images/center.png)","If a piece moves to a cell occupied by an opponent's piece, that piece is captured and removed from the board. Any piece can capture any other piece. There are no forced takes, meaning that the player can choose not to capture a piece even if they have that option.","---","### Promotions","Pieces can be promoted to have a different role than the :pawn. Promotions can occur by reaching specific cells or by arranging pieces in specific formations.","If three pieces are placed in a straight line on adjacent cells connected by edges (either along the same row or within the same circle), the middle piece can be promoted to :infantry, provided it has not already been promoted and the middle cell is not in the home area. Note that diagonal placements do not qualify, as the cells must share edges to form a valid line. Additionally, the cells must form a continuous, straight alignment; configurations where cells are edge-connected but not in a straight line or an arc do not count. If the middle cell is the center cell of the board, the other two pieces must occupy cells that are directly opposite each other. The promotion takes one turn to complete, meaning that instead of moving any piece, player uses the turn to promote the piece. The :infantry piece is marked by a :infantry_title symbol and can move up to :infantry_steps steps at a time. Movement may not be in one direction, for example, piece can make a step forward and a step left.","![Promotion formation](images/promotion.png) ![Infantry](images/infantry.png)","---","### :rider","If a piece reaches the :rider promotion cell (a circular cell on the left side of the center area, marked by a :rider_title), it is promoted to a :rider automatically, without requiring a turn. The :rider piece is marked by a :rider_title symbol. This piece can move up to :rider_steps steps and can jump over other pieces. Same as :infantry, :rider can make steps in different directions.","![:rider](images/rider.png)","---","### :sentinel","If a piece reaches the :sentinel promotion cell (a circular cell on the right side of the center area, marked by a :sentinel_title), it is promoted to a :sentinel automatically, also without requiring a turn. The :sentinel piece is marked by a :sentinel_title symbol and can move up to :sentinel_steps steps.","![Sentinel](images/sentinel.png)","---","### :sentinel feature","The :sentinel piece can revive a piece captured on the previous turn, provided the captured piece was in reach of the :sentinel revive range, which is :revive_range. This revival undoes the previous turn, restoring the captured piece and moving the opponent's piece back to its previous position. The revived piece cannot be captured on the next turn, and any promotion it held before capture is lost - it's revived as a :pawn.","---","### :sentinel additional rules","Each player may only have one :sentinel piece at a time. If a :sentinel is captured, the player may promote another piece to become a :sentinel. If a piece is on the :sentinel promotion cell when :sentinel is captured, it must step off the :sentinel promotion cell and then step back to get promoted to :sentinel. If a piece is captured on a :rider promotion cell, and then revived by :sentinel, it's revived as a regular :pawn and must step off the :rider promotion cell and then step back to get promoted to :rider. If, in such case, the opponents piece is promoted to a :rider, after reviving it's demoted to its previous role.",":video","---","### :sentinel immunity",":sentinel in the central cell (A cell) can only be captured by other :sentinel or a :rider. If a :sentinel in a central cell revives any piece, it losts its immunity for one turn.","---","### Main objective","The main objective of the game is to gain control of the center. This is accomplished by placing a promoted piece in the center and positioning any two pieces in opposite cells within the inner circle.","![Winning position](images/winning.png)","The winner gets :position_victory_points points while the loser gets 0 points. If a winning formation is composed of a :sentinel in the center and two :rider pieces in the opposite cells of the inner circle, then the winner gets :special_position_victory_points points. If a central piece in the formation is a :pawn then the victory is not granted, as the :pawn is not promoted. However, this position allows player to promote the central :pawn on the next turn, which, if done, will instantly grant victory.","---","### Domination victory","The game can also be won by capturing all opponents pieces, provided that the player still has more than 7 pieces left. In such case, the winner is granted with :domination_victory_points points while the loser gets 0 points.","### Draw","A draw is declared automatically if a player has fewer than three pieces remaining, as they can no longer achieve victory. A draw can also be declared at any time if both players agree. If draw is called or declared automatically, both players receive :draw_points points."],k=class extends t{name="tutorial";remove=e=>{this.node.remove()};tutorialToHTML=e=>({name:"tutorial-entry",props:{innerHTML:c(e,{video:"![video](images/sentinel.mp4)",pawn:m(i.promotions.pawn.name),infantry_title:i.promotions.infantry.title,infantry_steps:i.promotions.infantry.steps,infantry:m(i.promotions.infantry.name),rider_title:i.promotions.rider.title,rider_steps:i.promotions.rider.steps,rider:m(i.promotions.rider.name),sentinel_title:i.promotions.sentinel.title,sentinel_steps:i.promotions.sentinel.steps,sentinel:m(i.promotions.sentinel.name),revive_range:i.promotions.sentinel.reviveSteps,position_victory_points:i.resultsConditions.positionVictoryPoints,special_position_victory_points:i.resultsConditions.specialPositionVictoryPoints,domination_victory_points:i.resultsConditions.dominationVictoryPointsDisplay,draw_points:i.resultsConditions.drawPointsDisplay})}});prepareTutorial=(e,t)=>({name:"tutorial-page",props:{className:t?"":"active"},children:Object.fromEntries(Object.entries(e.map(this.tutorialToHTML)))});tutorialContent=Object.fromEntries(Object.entries(((e,t)=>e.reduce(((e,i)=>(i===t?e[e.length-1].length>0&&e.push([]):e[e.length-1].push(i),e)),[[]]))(b,"---").map(this.prepareTutorial)));children={popupWrapper:{children:{popup:{children:{closebutton:{listeners:{click:e=>{this.remove()}}},tutorialContent:{children:this.tutorialContent},next:{props:{innerText:"Next"},listeners:{click:e=>{let t=this.lookup("tutorial-page"),i=t.findIndex((e=>e.node.classList.contains("active")));t[i].node.classList.remove("active"),i++,i=i<t.length?i:0,t[i].node.classList.add("active")}}}}}}}}},P=class extends t{name="log-move";constructor(e){super(),this.props.innerText=e}},C=class extends t{name="log-separator";props={innerText:" - "}},I=class extends t{name="log-entry";constructor(e){super(),this.children={0:new P(e)}}},D=class extends t{name="game-info";constructor(){super(),this._turn=1,this._hash="",this.currentLog=null,this.log=[]}bindings={turn:{set:e=>{this.infoTable.generalInfo.turnNumber.node.innerText=e,this._turn=e},get:e=>this._turn},hash:{set:e=>{this.infoTable.generalInfo.hash.node.value=e,this._hash=e},get:e=>this._hash}};moveInfo=(e,t,i)=>e.join(" ")+(i.taken?"revive"==t?`+${i.taker},${i.taken}`:"x":"")+(i.promotion?`^${i.promotion.new[0].toUpperCase()}`:"");logMove=(t,i,n)=>{let s=this.moveInfo(t,i,n);this.log.push({turn:this.turn,player:e.activePlayer,move:t,type:i,data:n}),this.currentLog?((new C).appendTo(this.currentLog),new P(s).appendTo(this.currentLog),this.currentLog=null):(this.currentLog=new I(s),this.currentLog.appendTo(this.infoTable.turnLog)),this.hash=e.bot.encodePosition(e.cellsData,~~!e.activePlayer)};showTutorial=t=>{(new k).appendTo(e.root)};children={options:{children:{help:{listeners:{click:e=>{this.showTutorial()}}}}},infoTable:{children:{generalInfo:{children:{hash:{name:"input",listeners:{change:e=>{setTimeout((t=>{x(e.target.value)}),10)}}},turnNumber:{props:{innerText:1}}}},turnLog:{}}}}},T=class{cellOrder=["A","B5","B6","B7","B8","B9","B10","D5","D6","D7","D8","D9","D10","E1","E2","E3","E4","E5","E6","E7","E8","E9","E10","E11","E12","E13","E14","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","F13","F14","G1","G2","G3","G4","G5","G6","G7","G8","G9","G10","G11","G12","G13","G14","H1","H2","H3","H4","H5","H6","H7","H8","H9","H10","H11","H12","H13","H14","I1","I2","I3","I4","I5","I6","I7","I8","I9","I10","I11","I12","I13","I14","K5","K6","K7","K8","K9","K10","L5","L6","L7","L8","L9","L10","R4","R5","R6","R7","S8","S9","S10","S11"];pieceCodes={"white pawn":"A","black pawn":"B","white infantry":"C","black infantry":"D","white rider":"E","black rider":"F","white sentinel":"G","black sentinel":"H"};constructor(){this.reversePieceCodes=Object.fromEntries(Object.entries(this.pieceCodes).map((([e,t])=>[t,e])))}encodePosition=(e,t)=>{e=Object.entries(e).filter((([e,t])=>null!==t.piece)).map((([e,t])=>({cell:e,color:["black","white"][t.piece.color],role:t.piece.role}))).sort(((e,t)=>this.cellOrder.indexOf(e.cell)-this.cellOrder.indexOf(t.cell)));let i="",n=0,s=0;for(let t of e){let e=this.cellOrder.indexOf(t.cell),o=e-n-s;s=1,n=e,i+=(o>0?o.toString():"")+this.pieceCodes[`${t.color} ${t.role}`]}return t+i};decodePosition=e=>{let t=[],i=0,n=0,s=+e.slice(0,1);for(e=e.slice(1);i<e.length;){let s=0;for(;i<e.length&&!this.reversePieceCodes[e[i]];)s=10*s+parseInt(e[i]),i++;n+=s;let o=this.cellOrder[n++],r=e[i++],[l,a]=this.reversePieceCodes[r].split(" ");t.push({color:l,role:a,cell:o})}return[s,t]};calculatePosition=e=>{};calculatePiece=e=>{}},x=t=>{e.bot=new T;let n=null;t&&(n=e.bot.decodePosition(t)),e.cellsData=Object.fromEntries([[i.centerFile,{cell:null,piece:null}]].concat(...i.files.split("").map((e=>{let[t,n]=[i.files[0],i.files.slice(-1)],s=e>=i.firstHomeFile&&e<=i.lastHomeFile,o=e==t||e==n;return Array(s?14:o?4:6).fill().map(((t,i)=>((e,t,i,n,s)=>[t+(e+(n?1:s?t==i?8:4:5)),{cell:null,piece:null}])(i,e,n,s,o)))})))),e.taken={black:[],white:[]},e.sentinels={black:!1,white:!1},e.activePiece=null,e.activePlayer=1,e.revived=null,e.active=!0,e.game&&(e.game.node.remove(),e.gameInfo.node.remove(),delete e.game,delete e.gameInfo),e.game=new y(n),e.game.appendTo(e.root),e.gameInfo=new D,e.gameInfo.appendTo(e.root),e.gameInfo.turn=1};e.root=document.body,x();